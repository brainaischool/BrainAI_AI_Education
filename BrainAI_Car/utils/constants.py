"""
Constants Module

프로젝트 전체에서 사용되는 상수 정의
"""

# ============================================================================
# 서보 모터 각도 설정 (마이크로비트 프로토콜)
# ============================================================================
SERVO_CENTER = 90   # 직진
SERVO_LEFT = 135    # 좌회전
SERVO_RIGHT = 45    # 우회전
SERVO_MIN = 45      # 최소 각도
SERVO_MAX = 135     # 최대 각도

# ============================================================================
# DC 모터 속도 설정
# ============================================================================
MOTOR_STOP = 0       # 정지
MOTOR_FORWARD = 600  # 전진 (181~1023 범위)
MOTOR_REVERSE = -1   # 후진 (마이크로비트가 -1을 후진으로 인식)

# 기본 설정
SPEED_DEFAULT = 600  # 기본 주행 속도 (약 59%)

# ============================================================================
# 모델 관련 상수
# ============================================================================
MODEL_INPUT_SIZE = (224, 224)
MODEL_INPUT_SHAPE = (1, 224, 224, 3)
MODEL_INPUT_CHANNELS = 3

# ============================================================================
# 차량 제어 관련 상수
# ============================================================================
DEFAULT_SPEED = 450
MIN_SPEED = 0
MAX_SPEED = 1000

DEFAULT_STEERING_MAX = 0
MIN_STEERING_ANGLE = -90
MAX_STEERING_ANGLE = 90

# ============================================================================
# 레이턴시 및 타임아웃 설정
# ============================================================================
LATENCY_THRESHOLD = 0.1
SPEED_CONFIRMATION_TIMEOUT = 5.0  # 초

# ============================================================================
# 비디오 스트림 관련
# ============================================================================
VIDEO_FRAME_DELAY = 0.01  # 초
VIDEO_WINDOW_NAME = "BrainAI Car Autonomous Driving System"

# ============================================================================
# 키 매핑
# ============================================================================
KEY_QUIT = ord('q')
KEY_START_STOP = ord('s')
KEY_MODEL_1 = ord('1')
KEY_MODEL_2 = ord('2')
KEY_MODEL_3 = ord('3')

# ============================================================================
# 모델 이름
# ============================================================================
MODEL_LANE_D1 = "laneD1"
MODEL_LANE_D2 = "laneD2"
MODEL_LANE_D3 = "laneD3"

# ============================================================================
# 로깅 형식
# ============================================================================
LOG_FORMAT = '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
LOG_DATE_FORMAT = '%Y-%m-%d %H:%M:%S'


# ============================================================================
# 유틸리티 함수
# ============================================================================
def steering_to_angle(steering_value: float) -> int:
    """
    조향 값을 서보 각도로 변환
    
    Args:
        steering_value: -1.0 ~ 1.0
        
    Returns:
        서보 각도 (45 ~ 135)
    """
    angle = 90 - int(steering_value * 45)
    return max(45, min(135, angle))


def angle_to_steering(servo_angle: int) -> float:
    """
    서보 각도를 조향 값으로 변환
    
    Args:
        servo_angle: 45 ~ 135
        
    Returns:
        조향 값 (-1.0 ~ 1.0)
    """
    steering = (servo_angle - 90) / 45.0
    return round(max(-1.0, min(1.0, steering)), 6)


# ============================================================================
# 버전 정보
# ============================================================================
__version__ = '1.0.0'
__author__ = 'BrainAI Co,.Ltd.'
__description__ = 'BrainAI Autonomous Driving Project - Constants'